!function(e){"use strict";e.fn.geoInput=function(o){function t(e,o,t){return e.css({"float":t,height:"12px","min-width":"12px",padding:"1px",margin:"1px",border:"1px solid #999","border-radius":"4px",color:a.color,"background-color":a.bgcolor,"text-align":"center","font-size":"12px","font-family":"console",cursor:"pointer"}),e.html(o),e.hover(function(){e.css({color:a.bgcolor,"background-color":a.color})},function(){e.css({color:a.color,"background-color":a.bgColor})}),e}function r(e,o){return e.css({height:"12px",padding:"1px",margin:"1px",border:"1px solid #999","border-radius":"4px",color:a.color,"background-color":a.bgcolor,"font-size":"12px","font-family":"console",cursor:"pointer"}),e.html(o),e.hover(function(){e.css({color:a.bgcolor,"background-color":a.color})},function(){e.css({color:a.color,"background-color":a.bgColor})}),e}function n(e,o){return e.css({width:"12px",height:"12px",padding:"1px",margin:"1px","float":o}),e}var s,i,a,l;return s=this,s.map=null,s.mapOptions={},s.marker=new google.maps.Marker,i={latLngStringToGoogle:function(e){var o;return o=e.split(","),new google.maps.LatLng(o[0],o[1])},latLngGoogleToString:function(e){return e.lat().toFixed(a.precision)+","+e.lng().toFixed(a.precision)},getInputId:function(){var e;return e=s.attr("id")},validateUniqueElementId:function(){var o=!1;return 1===e("#"+i.getInputId()).length&&(o=!0),o}},a=e.extend({apikey:"<APIKEY>",width:"300px",height:"150px",bgColorMap:"#A3C3FF",bgColor:"#DDD",txtColor:"#000",precision:6,zoomLevel:2,mapCenter:"0,0",i_geoCode:"&#9992;",i_revGeoCode:"&#9873;?",i_markerToCenter:"&#9873;",i_centerOnMarker:"&#x2750;",i_togglePrefs:"&#9881;"},o),s.prefs={zoomStore:"dmgig_"+i.getInputId()+"_zoomLevel",centerStore:"dmgig_"+i.getInputId()+"_mapCenter",storeZoomLevel:function(){sessionStorage.setItem(s.prefs.zoomStore,s.map.getZoom()),console.log(sessionStorage)},storeMapCenter:function(){sessionStorage.setItem(s.prefs.centerStore,i.latLngGoogleToString(s.map.getCenter())),console.log(sessionStorage)},getStoredZoom:function(){return parseInt(sessionStorage.getItem(s.prefs.zoomStore),10)},getStoredMapCenter:function(){return i.latLngStringToGoogle(sessionStorage.getItem(s.prefs.centerStore))},clearPreferences:function(){sessionStorage.removeItem(s.prefs.zoomStore),sessionStorage.removeItem(s.prefs.centerStore),console.log(sessionStorage)}},a.mapCenter=i.latLngStringToGoogle(a.mapCenter),null!==sessionStorage.getItem(s.prefs.zoomStore)&&(a.zoomLevel=s.prefs.getStoredZoom()),null!==sessionStorage.getItem(s.prefs.centerStore)&&(a.mapCenter=s.prefs.getStoredMapCenter()),this.empty(),l={},l.geoInput=e("<div/>",{id:"dmgig_geoInput_"+i.getInputId()}),l.map=e("    <div/>",{id:"dmgig_map_"+i.getInputId()}).appendTo(l.geoInput),l.mapControls=e("    <div/>").appendTo(l.geoInput),l.geoControls=e("    <div/>").appendTo(l.geoInput),l.clear=e('        <div style="clear:both"></div>').appendTo(l.geoControls),l.rGeoResults=e("    <div/>").appendTo(l.geoInput),l.rgcTable=e("        <table>").appendTo(l.rGeoResults),l.rgcHead=e("            <thead>").appendTo(l.rgcTable),l.rgcTr=e("                <tr>").appendTo(l.rgcHead),l.rgcTh1=e("                    <th>&nbsp;&nbsp;&nbsp;Result Sets Found:</th>").appendTo(l.rgcTr),l.rgcTh2=e("                    <th></th>").appendTo(l.rgcTr),this.append(l.geoInput),l.latLngDisplay=e("<div/>"),l.revGeoCodeResultsBody=e("<tbody>"),l.revGeoCodeFoundCount=e("<span/>"),l.prefsPanel=e("<div/>"),l.geoCode=e("<div/>",{title:"geocode from text"}),l.revGeoCode=e("<div/>",{title:"reverse geocode marker location"}),l.markerToCenter=e("<div/>",{title:"bring marker(s) to center"}),l.centerOnMarker=e("<div/>",{title:"center map on marker(s)"}),l.revGeoCodeResultsHide=e("<span/>",{title:"hide results"}),l.togglePrefs=e("<div/>",{title:"toggle preferences"}),l.storeZoomLevel=e("<div/>",{title:"store zoom level"}),l.storeMapCenter=e("<div/>",{title:"store map center"}),l.storeMarkerCount=e("<div/>",{title:"store marker count"}),l.clearPreferences=e("<div/>",{title:"clear data storage"}),l.geoCodeInput=e("<input/>"),l.latInput=e("<input/>",{type:"hidden",name:"lat"}),l.lngInput=e("<input/>",{type:"hidden",name:"lng"}),l.hiddenInputs=e("<div/>"),l.spacerRight=e("<div/>"),l.spacerLeft=e("<div/>"),l.mapControls.append(l.latLngDisplay),"<APIKEY>"!==a.apikey&&""!==a.apikey?l.geoControls.prepend(l.geoCode,l.geoCodeInput,l.spacerLeft,l.revGeoCode,l.togglePrefs,l.spacerRight,l.markerToCenter,l.centerOnMarker):l.geoControls.prepend(l.geoCode,l.geoCodeInput,l.spacerLeft,l.togglePrefs,l.spacerRight,l.markerToCenter,l.centerOnMarker),l.rgcTh1.prepend(l.revGeoCodeResultsHide),l.rgcTh1.append(l.revGeoCodeFoundCount),l.rgcTable.append(l.revGeoCodeResultsBody),l.rGeoResults.after(l.latInput,l.lngInput,l.hiddenInputs),l.prefsPanel.append(l.storeZoomLevel,l.storeMapCenter,l.clearPreferences),l.geoControls.after(l.prefsPanel),l.geoInput.css({width:a.width,position:"relative",border:"1px solid #AAA"}),l.map.css({width:a.width,height:a.height,border:"1px solid #CCC","background-color":a.bgColor,"text-align":"center"}),l.map.html("<br /><br />loading..."),l.rGeoResults.css({clear:"both",display:"none",left:"-1px",width:"calc("+a.width+" - 8px)","background-color":"#FFF",border:"2px solid #CCC",position:"absolute","z-index":"5555","text-align":"left",padding:"3px"}),l.rgcTable.css({"font-size":"12px","font-family":"Arial"}),l.prefsPanel.css({clear:"both",display:"none",left:"-1px",width:"calc("+a.width+" - 2px)","background-color":"#DDD",border:"2px solid #CCC",position:"absolute","z-index":"9999"}),l.latLngDisplay.css({"font-size":"12px","text-align":"center","background-color":"#666",color:"#FFF","margin-bottom":"2px"}),l.latLngDisplay.html("0,0"),t(l.geoCode,a.i_geoCode,"left"),t(l.revGeoCode,a.i_revGeoCode,"left"),t(l.markerToCenter,a.i_markerToCenter,"right"),t(l.centerOnMarker,a.i_centerOnMarker,"right"),t(l.togglePrefs,a.i_togglePrefs,"right"),l.revGeoCodeResultsHide.html("&times;").css("cursor","pointer"),r(l.storeZoomLevel,"store zoom level"),r(l.storeMapCenter,"store map center position"),r(l.storeMarkerCount,"store markers count"),r(l.clearPreferences,"clear storage data"),l.geoCodeInput.css({"float":"left"}),n(l.spacerRight,"right"),n(l.spacerLeft,"left"),l.geoCode.on("click",function(){s.geocodeTextLocation()}),l.revGeoCode.on("click",function(){s.reverseGeocodeMarkerPosition()}),l.centerOnMarker.on("click",function(){s.centerToMarker()}),l.markerToCenter.on("click",function(){s.markerToCenter()}),l.storeZoomLevel.on("click",function(){s.prefs.storeZoomLevel()}),l.storeMapCenter.on("click",function(){s.prefs.storeMapCenter()}),l.clearPreferences.on("click",function(){s.prefs.clearPreferences()}),l.revGeoCodeResultsHide.on("click",function(){l.rGeoResults.hide()}),l.togglePrefs.click(function(){var o=e(this).data("clicks");o,l.prefsPanel.slideToggle(),e(this).data("clicks",!o)}),this.initialize=function(){s.mapOptions={zoom:a.zoomLevel,center:a.mapCenter},s.map=new google.maps.Map(document.getElementById("dmgig_map_"+i.getInputId()),s.mapOptions),s.marker.setPosition(a.mapCenter),s.marker.setMap(s.map),s.marker.setDraggable(!0),s.setLatLngInputs()},s.watchMarkerMove=google.maps.event.addListener(s.marker,"dragend",function(){s.setLatLngInputs(),l.hiddenInputs.empty()}),s.setLatLngInputs=function(){var e,o;e=s.marker.getPosition(),o=e.lat().toFixed(a.precision)+","+e.lng().toFixed(a.precision),l.latLngDisplay.html(o),l.latInput.val(e.lat().toFixed(a.precision)),l.lngInput.val(e.lng().toFixed(a.precision))},s.centerToMarker=function(){s.map.setCenter(s.marker.getPosition()),s.setLatLngInputs()},s.markerToCenter=function(){s.marker.setPosition(s.map.getCenter()),s.setLatLngInputs()},s.geocodeTextLocation=function(){var o,t,r;r=l.geoCodeInput.val(),o=encodeURIComponent(l.geoCodeInput.val()),e.get("https://maps.googleapis.com/maps/api/geocode/json?address="+o,function(e){t=new google.maps.LatLng(e.results[0].geometry.location.lat,e.results[0].geometry.location.lng),s.map.setCenter(t),s.markerToCenter()}).fail(function(){alert("Failed to geocode "+r)})},s.reverseGeocodeMarkerPosition=function(){var o,t,r;o=s.marker.getPosition(),t=o.lat().toString()+","+o.lng().toString(),r=encodeURIComponent(t),e.get("https://maps.googleapis.com/maps/api/geocode/json?latlng="+r+"&location_type=ROOFTOP&result_type=street_address&key="+a.apikey,function(o){var t,r;if(l.hiddenInputs.empty(),l.revGeoCodeResultsBody.empty(),l.revGeoCodeFoundCount.html(o.results.length),l.rGeoResults.show(),0!==o.results.length){t=o.results[0].address_components;for(r in t)e(s.revGeocodeResultsMakeRow(t[r].long_name,t[r].types)).appendTo(l.revGeoCodeResultsBody),e(s.revGeocodeResultsAddHiddenInputs(t[r].short_name,t[r].types))}}).fail(function(){alert("Failed to reverse geocode "+t)})},this.revGeocodeResultsMakeRow=function(o,t){return e("<tr><td><b>"+o+"</b> <i>"+t.join(", ")+"</i></td><td>&square;</td></tr>")},this.revGeocodeResultsAddHiddenInputs=function(o,t){e("<input/>",{type:"hidden",name:t[0],value:o}).appendTo(l.hiddenInputs)},s.parent_form=e(this).closest("form"),s.parent_form.on("submit",function(){return l.geoCodeInput.prop("disabled",!0),setTimeout(function(){l.geoCodeInput.prop("disabled",!1)},300),!1}),i.validateUniqueElementId()?void this.initialize():(console.log("geoInput Err: input elements require unique ids."),!1)}}(jQuery);
